<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <title>Seat</title>
  <meta charset="utf-8">
  <!-- 介绍 -->
  <meta name="Keywords" content="FreezeFrame" />
  <meta name="description" content="FreezeFrame"/>
  <!-- <meta name="author" content="luuman"> -->
  <!-- 清除cache -->
  <meta http-equiv="Expires" content="-1">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Pragma" content="no-cache">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <!-- icon -->
  <!-- <link rel="icon" href="favicon.png"> -->
  <!-- 移动端 -->
  <meta name="format-detection" content="email=no">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="">
  <!-- link -->
  <style type="text/css">
    html, body{
      width: 100%;
      height: 100%;
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
      font-family: Arial,Verdana,Sans-serif;
    }
    body, div, dl, dt, dd, ul, ol, li, h1, h2, h3, h4, h5, h6, pre, code, form, fieldset, legend, input, textarea, p, blockquote, th, td, hr, button, article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section{
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    input, select, textarea{
      font-size: 100%;
      outline: 0;
    }
    table{
      border-collapse: collapse;
      border-spacing: 0;
    }
    fieldset, img{
      border: 0;
    }
    abbr, acronym{
      border: 0;
      font-variant: normal;
    }
    del{
      text-decoration: line-through;
    }
    address, caption, cite, code, dfn, em, th, var{
      font-style: normal;
      font-weight: 500;
    }
    ol, ul{
      list-style: none;
    }
    caption, th{
      text-align: left;
    }
    h1, h2, h3, h4, h5, h6{
      font-size: 100%;
      font-weight: 500;
    }
    q:before, q:after{
      content: '';
    }
    sub, sup{
      font-size: 75%;
      line-height: 0;
      position: relative;
      vertical-align: baseline;
    }
    sup{
      top: -.5em;
    }
    sub{
      bottom: -.25em;
    }
    a:hover{
      text-decoration: underline;
    }
    ins, a{
      text-decoration: none;
    }
    #app{
      position: relative;
      height: 300px;
      width: 320px;
      border:1px solid #CCC;
      overflow: auto;
    }
    #app .list div{
      /*position: absolute;*/
      background-image: url("data:image/svg+xml;charset=utf8,%3Csvg width='330' height='36' viewBox='0 0 330 36' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Ctitle%3EGroup 10%3C/title%3E%3Cdefs%3E%3Cpath d='M31.97 3.84c0-2.12-1.78-3.84-3.973-3.84H9.127c-2.192 0-3.97 1.72-3.97 3.84v24.004h26.812V3.84zm3.866 3.38H34.29c-.713 0-1.29.523-1.29 1.17v20.39H4.125V8.39c0-.647-.577-1.17-1.29-1.17H1.29C.576 7.22 0 7.742 0 8.39v21.563c0 .647.577 1.172 1.29 1.172h1.546c.712 0 1.29-.525 1.29-1.172v1.875c0 .647.576 1.172 1.288 1.172H31.71c.713 0 1.29-.525 1.29-1.172v-1.875c0 .647.577 1.172 1.29 1.172h1.546c.712 0 1.29-.525 1.29-1.172V8.39c0-.647-.578-1.17-1.29-1.17z' id='a'/%3E%3Cpath d='M32.722 3.93c0-2.17-1.82-3.93-4.066-3.93H9.344C7.098 0 5.278 1.76 5.278 3.93V28.5h27.444V3.93zm3.96 3.46h-1.585c-.73 0-1.32.536-1.32 1.198V29.46H4.223V8.588c0-.662-.59-1.2-1.32-1.2H1.32C.59 7.39 0 7.927 0 8.59v22.07c0 .664.59 1.2 1.32 1.2h1.583c.73 0 1.32-.536 1.32-1.2v1.92c0 .663.59 1.2 1.32 1.2h26.915c.73 0 1.32-.537 1.32-1.2v-1.92c0 .664.59 1.2 1.32 1.2h1.583c.73 0 1.32-.536 1.32-1.2V8.59c0-.662-.59-1.2-1.32-1.2z' id='b'/%3E%3Cpath d='M274.722 3.93c0-2.17-1.82-3.93-4.066-3.93h-19.312c-2.246 0-4.066 1.76-4.066 3.93V28.5h27.444V3.93zm3.96 3.46h-1.585c-.73 0-1.32.536-1.32 1.198V29.46h-29.555V8.588c0-.662-.59-1.2-1.32-1.2h-1.583c-.73 0-1.32.538-1.32 1.2v22.07c0 .664.59 1.2 1.32 1.2h1.583c.73 0 1.32-.536 1.32-1.2v1.92c0 .663.59 1.2 1.32 1.2h26.915c.73 0 1.32-.537 1.32-1.2v-1.92c0 .664.59 1.2 1.32 1.2h1.583c.73 0 1.32-.536 1.32-1.2V8.59c0-.662-.59-1.2-1.32-1.2z' id='c'/%3E%3C/defs%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg transform='translate(1 1)'%3E%3Cuse fill='%23FFF' xlink:href='%23a'/%3E%3Cpath stroke='%23CACCD3' d='M32.47 3.84v24.504H4.655V3.84c0-2.4 2.006-4.34 4.472-4.34h18.87c2.465 0 4.47 1.94 4.47 4.34zm1.03 27.614v.374c0 .935-.81 1.672-1.79 1.672H5.415c-.978 0-1.79-.737-1.79-1.672v-.374c-.238.11-.506.17-.788.17H1.29c-.98 0-1.79-.736-1.79-1.67V8.39c0-.934.81-1.67 1.79-1.67h1.546c.978 0 1.79.736 1.79 1.67v19.89H32.5V8.39c0-.934.81-1.67 1.79-1.67h1.546c.978 0 1.79.736 1.79 1.67v21.563c0 .935-.812 1.672-1.79 1.672H34.29c-.283 0-.55-.06-.79-.17z'/%3E%3C/g%3E%3Cpath d='M49.1 9.86h17.84v1.4H64.3v13.6c0 1.32-.64 2-1.92 2h-3.34l-.32-1.4c1.1.04 2.16.08 3.16.08.64 0 .98-.36.98-1.04V11.26H49.1v-1.4zm10.1 4.46v7.34h-6.38v1.76h-1.4v-9.1h7.78zm-6.38 6.02h5v-4.72h-5v4.72zM80.4 8.62h1.4v2.56h3.94v1.36H81.8v2.8h4.68v1.4h-3.3v5.34c0 .32.18.48.58.48h.74c.32 0 .56-.06.76-.18.26-.16.42-.92.5-2.28l1.26.42c-.16 1.62-.38 2.58-.7 2.88-.28.28-.8.44-1.54.44h-1.46c-.48 0-.86-.14-1.1-.42-.26-.28-.38-.62-.38-1.02v-5.66h-1.98c-.06 1.36-.26 2.54-.58 3.52-.54 1.52-1.74 2.76-3.62 3.74l-.92-1.14c1.6-.78 2.66-1.78 3.18-2.98.32-.84.52-1.9.6-3.14h-3.1v-1.4h4.98v-2.8h-3.22c-.36.76-.74 1.44-1.18 2.08l-1.22-.78c1.04-1.48 1.78-3.14 2.24-4.94l1.38.28c-.2.7-.4 1.36-.64 2h2.64V8.62zm-9.88.36l-.98.94c1.42 1.12 2.54 2.18 3.36 3.18l1-1c-.92-1.04-2.04-2.08-3.38-3.12zm11.7 17.66c-1.1 0-2.3-.02-3.58-.04-1.3-.02-2.36-.14-3.16-.36-.8-.24-1.52-.74-2.14-1.46-.28-.34-.54-.5-.78-.5-.48 0-1.28.9-2.38 2.74l-1.08-.96c1.06-1.68 2-2.7 2.82-3.06v-6.08h-2.84V15.6h4.18v7.48c.16.12.32.26.5.46.48.58 1 1 1.56 1.26.64.28 1.54.44 2.74.48 1.06.02 2.38.04 3.96.04.92 0 1.88-.02 2.86-.04.96-.02 1.7-.04 2.22-.08l-.34 1.44h-4.54z' fill='%23333'/%3E%3Cg transform='translate(122 1)'%3E%3Cuse fill='%23F44336' xlink:href='%23b'/%3E%3Cpath stroke='%23D32F2F' d='M33.222 3.93V29H4.778V3.93c0-2.45 2.048-4.43 4.566-4.43h19.312c2.518 0 4.566 1.98 4.566 4.43zm1.056 28.247v.4c0 .95-.825 1.7-1.82 1.7H5.542c-.995 0-1.82-.75-1.82-1.7v-.4c-.247.116-.526.182-.82.182H1.32c-.995 0-1.82-.75-1.82-1.7V8.587c0-.95.825-1.7 1.82-1.7h1.583c.995 0 1.82.75 1.82 1.7V28.96h28.555V8.588c0-.95.824-1.7 1.82-1.7h1.583c.995 0 1.82.75 1.82 1.7v22.07c0 .95-.825 1.7-1.82 1.7h-1.583c-.293 0-.572-.065-.82-.18z'/%3E%3C/g%3E%3Cg fill='%23FBD4A2'%3E%3Cpath d='M149.58 14.307c-.002.023-.025.147-.15.178-.006 0-.01.004-.017.007-.16.07-.407.27-.493.83-.032.255-.085.52-.14.805l-.002.003c-.16.81-.418 1.483-.765 2-.486.722-1.145 1.125-1.91 1.164-.556.028-1.024.03-1.43.005-1.177-.073-1.852-.37-2.33-1.03-.642-.887-.936-2.498-1.317-2.498-.38 0-.675 1.61-1.318 2.498-.477.66-1.152.957-2.328 1.03-.407.024-.875.022-1.432-.006-.763-.04-1.423-.442-1.908-1.164-.348-.517-.605-1.19-.766-2v-.003c-.057-.285-.11-.55-.14-.804-.088-.562-.333-.76-.494-.83-.006-.004-.012-.007-.018-.008-.124-.03-.148-.155-.15-.178-.014-.228-.072-.734-.092-1.05-.015-.236.183-.267.22-.27 1.39-.085 4.612-.254 6.077.12.437.112 1.69.344 2.35.344.66 0 1.91-.23 2.35-.343 1.464-.374 4.686-.205 6.075-.12.037.003.236.034.22.27-.02.316-.077.822-.092 1.05m-5.887-6.7C142.01 7.173 141.493 5 138.347 5c1.138 1.278.613 2.4-.24 2.658-4.17 1.09-7.296 4.523-7.098 9.27C131.21 21.812 135.48 25 141 25s9.787-3.187 9.99-8.073c.202-4.822-3.028-8.29-7.297-9.32'/%3E%3Cpath d='M138.155 14.288c-.507-.09-1.54-.212-2.34-.165-.35.02-.658.075-.854.18-.485.258-.525.665-.443 1.212.024.16.058.33.094.512.196.975.655 2.014 1.612 2.066.43.024.782.025 1.074.008.898-.052 1.222-.282 1.445-.594 1.277-1.783.772-2.955-.484-3.2l-.1-.018zM143.983 14.256c.507-.09 1.54-.212 2.34-.165.35.022.657.075.853.18.487.26.526.666.445 1.213-.023.16-.057.33-.094.512-.194.975-.654 2.014-1.61 2.066-.43.024-.783.026-1.074.01-.9-.054-1.222-.285-1.445-.597-1.276-1.783-.772-2.954.485-3.2.03-.005.065-.01.1-.017z'/%3E%3C/g%3E%3Cpath d='M185.66 17.72v-8h-14.92v1.4h13.46v5.22h-10.94v-2.88h-1.44V24c0 1.56.74 2.36 2.26 2.36h11.04c.8-.04 1.4-.26 1.84-.68.44-.52.76-2 .96-4.48l-1.4-.44c-.1 2.2-.34 3.48-.7 3.84-.28.24-.66.36-1.1.36h-10.24c-.82 0-1.22-.42-1.22-1.24v-6h12.4zm20.4 3.52v5.84h-1.42v-.98h-10.6v.98h-1.42v-5.84h13.44zm-12.02 3.58h10.6v-2.34h-10.6v2.34zm-1.42-10.96c-.72.84-1.5 1.62-2.36 2.36l-.44-1.42c2.08-1.9 3.56-3.98 4.42-6.22l1.4.28c-.24.6-.5 1.18-.8 1.76h4.96c-.3-.68-.62-1.28-.98-1.84l1.48-.24c.32.62.62 1.32.9 2.08h5.82v1.2h-6.08v1.46h5.2v1.14h-5.2v1.4h5.24v1.14h-5.24v1.5h6.4v1.22h-14.72v-5.82zm6.9 4.6v-1.5H194v1.5h5.52zm0-2.64v-1.4H194v1.4h5.52zm0-2.54v-1.46h-5.38c-.06.08-.1.14-.14.22v1.24h5.52z' fill='%23333'/%3E%3Cg transform='translate(1 1)'%3E%3Cuse fill='%2370C972' xlink:href='%23c'/%3E%3Cpath stroke='%2341A343' d='M275.222 3.93V29h-28.444V3.93c0-2.45 2.048-4.43 4.566-4.43h19.312c2.518 0 4.566 1.98 4.566 4.43zm1.056 28.247v.4c0 .95-.825 1.7-1.82 1.7h-26.916c-.995 0-1.82-.75-1.82-1.7v-.4c-.247.116-.526.182-.82.182h-1.583c-.995 0-1.82-.75-1.82-1.7V8.587c0-.95.825-1.7 1.82-1.7h1.583c.995 0 1.82.75 1.82 1.7V28.96h28.555V8.588c0-.95.824-1.7 1.82-1.7h1.583c.995 0 1.82.75 1.82 1.7v22.07c0 .95-.825 1.7-1.82 1.7h-1.583c-.293 0-.572-.065-.82-.18z'/%3E%3C/g%3E%3Cpath d='M306.66 17.72v-8h-14.92v1.4h13.46v5.22h-10.94v-2.88h-1.44V24c0 1.56.74 2.36 2.26 2.36h11.04c.8-.04 1.4-.26 1.84-.68.44-.52.76-2 .96-4.48l-1.4-.44c-.1 2.2-.34 3.48-.7 3.84-.28.24-.66.36-1.1.36h-10.24c-.82 0-1.22-.42-1.22-1.24v-6h12.4zm15.74-9.1h1.4v2.56h3.94v1.36h-3.94v2.8h4.68v1.4h-3.3v5.34c0 .32.18.48.58.48h.74c.32 0 .56-.06.76-.18.26-.16.42-.92.5-2.28l1.26.42c-.16 1.62-.38 2.58-.7 2.88-.28.28-.8.44-1.54.44h-1.46c-.48 0-.86-.14-1.1-.42-.26-.28-.38-.62-.38-1.02v-5.66h-1.98c-.06 1.36-.26 2.54-.58 3.52-.54 1.52-1.74 2.76-3.62 3.74l-.92-1.14c1.6-.78 2.66-1.78 3.18-2.98.32-.84.52-1.9.6-3.14h-3.1v-1.4h4.98v-2.8h-3.22c-.36.76-.74 1.44-1.18 2.08l-1.22-.78c1.04-1.48 1.78-3.14 2.24-4.94l1.38.28c-.2.7-.4 1.36-.64 2h2.64V8.62zm-9.88.36l-.98.94c1.42 1.12 2.54 2.18 3.36 3.18l1-1c-.92-1.04-2.04-2.08-3.38-3.12zm11.7 17.66c-1.1 0-2.3-.02-3.58-.04-1.3-.02-2.36-.14-3.16-.36-.8-.24-1.52-.74-2.14-1.46-.28-.34-.54-.5-.78-.5-.48 0-1.28.9-2.38 2.74l-1.08-.96c1.06-1.68 2-2.7 2.82-3.06v-6.08h-2.84V15.6h4.18v7.48c.16.12.32.26.5.46.48.58 1 1 1.56 1.26.64.28 1.54.44 2.74.48 1.06.02 2.38.04 3.96.04.92 0 1.88-.02 2.86-.04.96-.02 1.7-.04 2.22-.08l-.34 1.44h-4.54z' fill='%23333'/%3E%3C/g%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: 300px;
      background-position: 2px 2px;
      float: left;
    }
    #app .list{
    }
    #app .list .isNo{
      background-position: -213px 2px;
    }
    #app .list .isChoose{
      background-position: -106px 2px;
    }
  </style>
</head>
<body>
  上万条数据的展示问题
  1. 浏览器：页面渲染费时，用户体验不好。
  2. 服务器：数据库查询费时，API延时。
  2. 当然要用户浏览的时候，也不可能一下子全部看完。
  3. 分组可以有效规避用户浏览的难度。
  <div id="app"></div>
  <div id="seatId"></div>
</body>
  <script type="text/javascript">
    Array.prototype.remove = function(val) {
      var index = this.indexOf(val)
      if (index > -1) {
        this.splice(index, 1)
      }
    }
    function dataInit (rows, cloumns) {
      var data = []
      for (var i = 0; i < cloumns; i++) {
        var list = []
        for (var j = 0; j < rows; j++) {
          list.push({
            content: 'item-' + (rows * i + j + 1),
            id: rows * i + j + 1,
            cloumns: i + 1,
            rows: j + 1,
            isNo: [true, false][Math.floor(Math.random()*[true, false].length)]
          })
        }
        data.push({
          id: i + 1,
          list: list
        })
      }
      return data
    }
    var data = dataInit(10, 1000)

    var seat = {
      List: {},
      pushList : [],
      width: 46,
      height: 36,
      init(data, Id) {
        var siteNum = 1
        var LHeight = 360
        var num = LHeight / seat.height
        var box = document.getElementById(Id)
        box.onscroll = function () {
          var sTop = this.scrollTop || 0,
            first = parseInt(sTop / seat.height, 10),
            start = Math.max(first - num, 0),
            end = Math.min(first + num, data.length - 1),
            i = 0;
          for (var s = start; s <= end; s++) {
            var child = box.children[s]
            if ((!box.contains(child)) && (s != data.length - 1)) {
              seat.insert(box, data[s], s)
            }
          }
          while (child = box.children[i++]) {
            var index = child.getAttribute('data-index')
            if ((index > end || index < start) && index != data.length - 1) {
              box.removeChild(child)
            }
          }
        }
        box.onscroll()
      },
      insert (box, item, index) {
        var oDiv = document.createElement('div')
        oDiv.setAttribute('data-index', data[index].id)
        oDiv.className = 'list'
        // oDiv.style.width = '460px'
        oDiv.style.height = seat.height + 'px'
        oDiv.style.top = index * seat.height + 'px'
        item.list.forEach((seats) => {
          var lists = document.createElement('div')
          lists.className = seats.isNo ? '' : 'isNo'
          lists.style.width = seat.width + 'px'
          lists.style.height = seat.height + 'px'
          lists.value = seats.id
          lists.onclick = function(e) {
            if (seats.isNo) {
              seat.choose(e)
            } else {
              alert('已售')
            }
            document.getElementById('seatId').innerHTML = seat.pushList
          }
          oDiv.appendChild(lists)
        })
        box.appendChild(oDiv)
      },
      choose (e) {
        if (!seat.List[e.target.value]) {
          seat.classAdd(e, 'isChoose')
          seat.List[e.target.value] = true
          seat.pushList.push(e.target.value)
        } else {
          seat.classMove(e, 'isChoose')
          seat.List[e.target.value] = false
          seat.pushList.remove(e.target.value)
        }
      },
      classAdd(e, Name) {
        e.target.className += ' ' + Name
      },
      classMove(e, Name) {
        e.target.className = e.target.className.replace(Name, '')
      },
      onScroll: function (e) {
        var height = this.height
        var offset = this.$refs.vsl.scrollTop

        if (height.total > height.keeps) {
          this.updateZone(offset)
        } else {
          height.end = height.total - 1
        }

        var offsetAll = height.offsetAll
        if (this.onscroll) {
          this.onscroll(e, {
            offset: offset,
            offsetAll: offsetAll,
            start: height.start,
            end: height.end
          })
        }

        if (!offset && height.total) {
          this.triggerEvent('totop')
        }

        if (offset >= offsetAll) {
          this.triggerEvent('tobottom')
        }
      }
    }
    seat.init(data, 'app', '40')
  </script>
</html>
